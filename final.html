<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数独</title>
    <script type="text/javascript">
        var num = new Array(9);
        var choice = new Array(81);
        var sum = [0,1,2,4,8,16,32,64,128,2a56];
        var row = [];
        var block = [];
        var k
        for(var i = 0;i < 81;i++){
            row[i] = Math.floor(i/9)
            block[i] = Math.floor(i/9 / 3) * 3 + Math.floor((i % 9) / 3);
        }
        function tt()
        {
            console.time(1);
            Solve();
            console.timeEnd(1);
        }
		function Solve()
		{
			for(var m = 0;m < 80000;m++)
				Produce();
			SET();
        }

        var i,j,n,m,x;
			var s = 0,p = 0;
			var str = '';
			var temp = [1,2,3,4,5,6,7,8,9];
			var t = [0];
			var c = [511,511,511,511,511,511,511,511,511];
			var b = [511,511,511,511,511,511,511,511,511];
			var r = [0,511,511,511,511,511,511,511,511];
        function Produce() {
			 temp = [1,2,3,4,5,6,7,8,9];
			 c = [511,511,511,511,511,511,511,511,511];
			 b = [511,511,511,511,511,511,511,511,511];
			 r = [0,511,511,511,511,511,511,511,511];
            for (i = 0; i < 9; i++)
			{
                num[i] = [0,0,0,0,0,0,0,0,0];
			}
            // for (i = 9; i < 81; i++)
            // {
			// 	choice[i] = 511;
			// }
            num[0] = shuffle(temp);
			for(i = 0;i < 9;i++)
			{
				m = block[i];
				n = num[0][i];
				c[i] -= sum[n];
				b[m] -= sum[n];
			}
            k = 9;
            select()
        }
            function select(){
                const i = row[k];
                const j = k % 9;
				const m = block[k];
                const x = r[i]&c[j]&b[m];
                if(!x){
                    return false
                }

                var temp = [];
				for(let s = 8; s >=0;s--)
				{

					if(x & 1 << s)
						temp.push(s+1);
                }

                // var t = shuffle(temp);
                var l = temp.length

                // for(var index = t.length-1;index>=0;index--){
                while(l){
                    let index = (Math.random() * l) << 0
                    let n = temp[index]
                    let _sum = 1 << (n-1)
					r[i] -= _sum;
					c[j] -= _sum;
                    b[m] -= _sum;
                    k++
					if((k>=81 ||select())){
                        num[i][j] = n;
                        return true
                    }else{
                        k--
                        r[i] += _sum;
                        c[j] += _sum;
                        b[m] += _sum;
                        temp[index] = temp[--l]

                    }
                }
            }
		function SET()
		{
			var location = new Array(9);
			var i,j,row,col;
			for(i = 0; i < 9; i++)
			location[i] = ['','','','','','','','',''];
			var loc = 'v';
			var loca;
			for(i = 1;i < 10;i++)
				for(j = 1;j < 10;j++)
				{
					loca = loc + i + '_' + j;
					row = i - 1;
					col = j - 1;
					location[row][col] = document.getElementById(loca);
					location[row][col].innerHTML = num[row][col];
				}
		}
        function shuffle(arr){
            var random,temp;
            var len = arr.length;
            while(len > 1){
                random = (Math.random() * len) << 0;
				len--;
                temp = arr[len];
                arr[len] = arr[random];
                arr[random] = temp;
            }
            return arr;
        }
		function mOut(obj)
		{
			obj.style.background = "transparent";
		}
		function mOver(obj)
		{
			obj.style.background = "lightgrey";
		}
    </script>
    <style type="text/css">
        table {
            margin:0 auto;
			border-collapse:collapse;
        }
        td.big
        {
            width:144px;
            height:144px;
            border:2px solid blue;
        }
        td.small
        {
            width:47px;
            height:47px;
            border:1px solid cornflowerblue;
            font-size:20px;
            text-align:center;
            font-family:Verdana;
        }
    </style>
</head>
<body onload="tt()">
<h1 align="center">数独游戏</h1>
<p align="center">玩家需要根据9×9盘面上的已知数字，推理出所有剩余空格的数字，并满足每一行、每一列、每一个粗线宫（3*3）内的数字均含1-9，不重复。</p>
<table text-align="center">
    <tr>
        <td class="big">
            <table >
                <tr>
                    <td id="v1_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v2_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v3_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table bgcolor="lavender">
                <tr>
                    <td id="v1_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v2_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v3_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table >
                <tr>
                    <td id="v1_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v1_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v2_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v2_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v3_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v3_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td class="big">
            <table bgcolor="lavender">
                <tr>
                    <td id="v4_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v5_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v6_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table >
                <tr>
                    <td id="v4_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v5_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v6_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table bgcolor="lavender" >
                <tr>
                    <td id="v4_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v4_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v5_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v5_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v6_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v6_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>

    </tr>
    <tr>
        <td class="big">
            <table>
                <tr>
                    <td id="v7_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v8_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v9_1" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_2" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_3" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table bgcolor="lavender">
                <tr>
                    <td id="v7_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v8_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v9_4" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_5" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_6" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>
        <td class="big">
            <table>
                <tr>
                    <td id="v7_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v7_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v8_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v8_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
                <tr>
                    <td id="v9_7" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_8" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                    <td id="v9_9" class="small" onmouseover="mOver(this)" onmouseout="mOut(this)"></td>
                </tr>
            </table>
        </td>

    </tr>
</table>
</body>
</html>
